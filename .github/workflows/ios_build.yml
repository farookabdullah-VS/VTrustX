
name: Build iOS App

on:
  push:
    branches: [ "main" ]
  workflow_dispatch:

jobs:
  build:
    name: Build iOS on Cloud Mac
    runs-on: macos-latest

    steps:
      - name: Checkout Code
        uses: actions/checkout@v6

      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'

      - name: Install Dependencies
        run: |
          cd client
          npm install

      - name: Build Web Assets
        run: |
          cd client
          npm run build

      - name: Install Capacitor & Sync iOS
        run: |
          cd client
          npm install @capacitor/core @capacitor/cli @capacitor/ios --legacy-peer-deps
          npx cap sync ios

      - name: Build iOS Project (Debug)
        run: |
          cd client/ios/App
          xcodebuild -workspace App.xcworkspace -scheme App -destination generic/platform=iOS -configuration Debug CODE_SIGNING_ALLOWED=NO
          
      # Note: To generate a real installable .ipa file, you would need to add 
      # Apple Developer Certificates to GitHub Secrets.
      # For now, this step proves the app compiles successfully on iOS.
